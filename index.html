<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>NL Navigator | Baseline Build 2025-12-27</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="style.css">
    
    </head>
<body>
    <div id="app-wrapper">
        <header class="system-header">
            <div class="brand-container">
                <div class="logo-group">
                    <h1>NL Navigator</h1>
                    <div class="build-info">
                        <span class="tag">BASELINE: 2025-12-27</span>
                        <span class="tag">DATA LOCK: 2025-12-26</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="workspace-layout">
            <aside class="sidebar-monitor">
                <section class="nav-module">
                    <h2>Primary Regions</h2>
                    <nav id="sidebar-nav">
                        <ul class="region-links">
                            <li><a href="#" class="region-trigger" data-region="Avalon">Avalon Peninsula</a></li>
                            <li><a href="#" class="region-trigger" data-region="Central">Central Newfoundland</a></li>
                            <li><a href="#" class="region-trigger" data-region="Western">Western Newfoundland</a></li>
                            <li><a href="#" class="region-trigger" data-region="Northern">Northern Peninsula</a></li>
                            <li><a href="#" class="region-trigger" data-region="Labrador">Labrador</a></li>
                        </ul>
                    </nav>
                </section>

                <section class="system-status-module">
                    <h2>System Status</h2>
                    <div class="status-card" id="weong-route-monitor">
                        <div class="status-header">
                            <span class="status-label">[weong-route]</span>
                            <span class="status-indicator pulse-green">ACTIVE</span>
                        </div>
                        <p class="status-detail">Level 3 Exception Trigger: Enabled</p>
                    </div>
                    <div class="status-card" id="data-integrity-monitor">
                        <div class="status-header">
                            <span class="status-label">DATABASE</span>
                            <span class="status-indicator locked">LOCKED</span>
                        </div>
                        <p class="status-detail">Source: communities.json</p>
                    </div>
                </section>
            </aside>

            <main class="data-viewport">
                <div class="viewport-header">
                    <div class="breadcrumb-trail">
                        <span class="root">Root</span> / <span class="current-loc">Newfoundland Deep-Dive</span>
                    </div>
                </div>

                <div id="map-interface">
                    <div id="map" style="height: 500px; background: #aad3df;"></div>
                </div>

                <section id="data-results-panel">
                    <div id="loader" class="loader-overlay hidden">
                        <div class="spinner"></div>
                        <p>Syncing with communities.json...</p>
                    </div>
                    <div id="results-grid-container" class="grid-display">
                        </div>
                </section>
            </main>
        </div>

        <footer class="global-footer">
            <div class="footer-status-bar">
                <div class="lock-status">
                    <span class="icon">ðŸ”’</span>
                    <span class="text">Newfoundland Comprehensive Data Permanently Stored</span>
                </div>
                <div class="session-stamp">
                    Session Anchor: 2025-12-27 | Map UI & JSON Active
                </div>
            </div>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script>
        // Restoring core logic for Map and Data rendering
        const map = L.map('map').setView([49.0, -56.0], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        async function initDashboard() {
            try {
                const response = await fetch('communities.json');
                const data = await response.json();
                renderMarkers(data);
                renderGrid(data);
            } catch (err) {
                console.error("Data Load Error:", err);
            }
        }

        function renderMarkers(communities) {
            communities.forEach(c => {
                const marker = L.marker([c.lat, c.lng]).addTo(map);
                marker.bindPopup(`<b>${c.name}</b><br>Level: ${c.level}`);
                // [weong-route] Level 3 Exception Color Logic
                if(c.level === 3) {
                    marker._icon.style.filter = "hue-rotate(120deg)";
                }
            });
        }

        function renderGrid(communities) {
            const container = document.getElementById('results-grid-container');
            container.innerHTML = communities.map(c => `
                <div class="data-card ${c.level === 3 ? 'exception-lvl3' : ''}">
                    <h3>${c.name}</h3>
                    <p>Region: ${c.region}</p>
                    <span class="level-tag">Level ${c.level}</span>
                </div>
            `).join('');
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
